

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Framework.Utils.cli_Utils &mdash; Warrior Ninja documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Warrior Ninja documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../warrior_index.html" class="icon icon-home"> Warrior
          

          
          </a>

          
            
            
              <div class="version">
                Ninja
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Actions.html">Actions package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Framework.html">Framework package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../warrior_index.html">Warrior</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../warrior_index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>Framework.Utils.cli_Utils</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Framework.Utils.cli_Utils</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Copyright 2017, Fujitsu Network Communications, Inc.</span>
<span class="sd">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="sd">you may not use this file except in compliance with the License.</span>
<span class="sd">You may obtain a copy of the License at</span>
<span class="sd">http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="sd">Unless required by applicable law or agreed to in writing, software</span>
<span class="sd">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="sd">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="sd">See the License for the specific language governing permissions and</span>
<span class="sd">limitations under the License.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&quot;&quot;&quot;Api for cli related operations &quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">Tools</span>
<span class="kn">import</span> <span class="nn">Framework.ClassUtils</span>
<span class="kn">from</span> <span class="nn">Framework.Utils</span> <span class="k">import</span> <span class="n">datetime_utils</span><span class="p">,</span> <span class="n">data_Utils</span><span class="p">,</span> <span class="n">xml_Utils</span>
<span class="kn">from</span> <span class="nn">Framework.Utils.data_Utils</span> <span class="k">import</span> <span class="n">get_object_from_datarepository</span>
<span class="kn">from</span> <span class="nn">Framework.Utils.print_Utils</span> <span class="k">import</span> <span class="n">print_debug</span><span class="p">,</span> <span class="n">print_info</span><span class="p">,</span>\
<span class="n">print_error</span><span class="p">,</span> <span class="n">print_exception</span>
<span class="kn">from</span> <span class="nn">Framework.Utils.testcase_Utils</span> <span class="k">import</span> <span class="n">pNote</span>
<span class="kn">from</span> <span class="nn">Framework.Utils.list_Utils</span> <span class="k">import</span> <span class="n">get_list_by_separating_strings</span>
<span class="kn">from</span> <span class="nn">Framework.ClassUtils.WNetwork.loging</span> <span class="k">import</span> <span class="n">ThreadedLog</span>
<span class="kn">from</span> <span class="nn">WarriorCore.Classes.war_cli_class</span> <span class="k">import</span> <span class="n">WarriorCliClass</span>
<span class="kn">from</span> <span class="nn">Framework.ClassUtils</span> <span class="k">import</span> <span class="n">database_utils_class</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pexpect</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">print_info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: pexpect module is not installed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
    <span class="n">print_info</span><span class="p">(</span><span class="s2">&quot;Warrior framework by default uses pexpect for all cli related activites&quot;</span><span class="p">)</span>
    <span class="n">print_info</span><span class="p">(</span><span class="s2">&quot;All default methods/functions that use cli will fail&quot;</span>\
               <span class="s2">&quot;without pexpect module. Users can however create&quot;</span>\
               <span class="s2">&quot;their own custom libraries for cli interaction </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="cmdprinter"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.cmdprinter">[docs]</a><span class="k">def</span> <span class="nf">cmdprinter</span><span class="p">(</span><span class="n">cmdfunc</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">WarriorCliClass</span><span class="o">.</span><span class="n">cmdprint</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cmdfunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;_send_cmd_get_status&quot;</span><span class="p">:</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;:CMD: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;command_list&quot;</span><span class="p">][</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]]))</span>
            <span class="k">elif</span> <span class="n">cmdfunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;_send_command_retrials&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">cmdfunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;send_command&quot;</span><span class="p">:</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;:CMD: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">cmdfunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;send_command_and_get_response&quot;</span><span class="p">:</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;:CMD: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">elif</span> <span class="n">cmdfunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;_send_cmd&quot;</span><span class="p">:</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;:CMD: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;command&#39;</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;:CMD: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cmdfunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">inner</span></div>

<div class="viewcode-block" id="connect_ssh"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.connect_ssh">[docs]</a><span class="k">def</span> <span class="nf">connect_ssh</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;22&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;.*(%|#|\$)&quot;</span><span class="p">,</span> <span class="n">conn_options</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">custom_keystroke</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Initiates SSH connection via a specific port. Creates log file.</span>
<span class="sd">    - return session as object and conn_string(pre and post login message).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sshobj</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">conn_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">conn_options</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">conn_options</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">conn_options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">conn_options</span>
    <span class="n">custom_keystroke</span> <span class="o">=</span> <span class="s2">&quot;wctrl:M&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">custom_keystroke</span> <span class="k">else</span> <span class="n">custom_keystroke</span>
    <span class="c1"># delete -o StrictHostKeyChecking=no and put them in conn_options</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">conn_options</span> <span class="ow">or</span> <span class="n">conn_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">conn_options</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;ssh -p </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">@</span><span class="si">{2}</span><span class="s1"> </span><span class="si">{3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">conn_options</span><span class="p">)</span>
    <span class="c1">#command = (&#39;ssh -p &#39;+ port + &#39; &#39; + username + &#39;@&#39; + ip)</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;connectSSH: cmd = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">WarriorCliClass</span><span class="o">.</span><span class="n">cmdprint</span><span class="p">:</span>
        <span class="n">pNote</span><span class="p">((</span><span class="s2">&quot;connectSSH: :CMD: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">command</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">timeout</span><span class="p">))</span>

    <span class="n">child</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

    <span class="k">if</span> <span class="n">logfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fdobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fdobj</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">fdobj</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="n">print_exception</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">flag</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">child</span><span class="o">.</span><span class="n">setecho</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">delaybeforesend</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="s2">&quot;(yes/no)&quot;</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="s1">&#39;.*(?i)password:.*&#39;</span><span class="p">,</span>
                                   <span class="s2">&quot;.*(?i)(user(name)?:|login:) *$&quot;</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">,</span>
                                   <span class="s1">&#39;.*(?i)remote host identification has &#39;</span>
                                   <span class="s1">&#39;changed.*&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">sshobj</span> <span class="o">=</span> <span class="n">child</span>
                <span class="n">conn_string</span> <span class="o">=</span> <span class="n">conn_string</span> <span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span> <span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">after</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
                <span class="n">conn_string</span> <span class="o">=</span> <span class="n">conn_string</span> <span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span> <span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">after</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Connection failed: </span><span class="si">{0}</span><span class="s2">, with the system response: </span><span class="si">{1}</span><span class="s2">&quot;</span>\
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> 
                <span class="c1"># Some terminal expect specific keystroke before showing login prompt</span>
                <span class="k">if</span> <span class="n">flag</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Initial timeout occur, sending custom_keystroke&quot;</span><span class="p">)</span>
                    <span class="n">_send_cmd_by_type</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">custom_keystroke</span><span class="p">)</span>
                    <span class="n">flag</span><span class="o">=</span><span class="kc">False</span>
                    <span class="k">continue</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Connection timed out: </span><span class="si">{0}</span><span class="s2">, expected prompt: </span><span class="si">{1}</span><span class="s2"> &quot;</span>\
                      <span class="s2">&quot;is not found in the system response: </span><span class="si">{2}</span><span class="s2">&quot;</span>\
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;ssh-keygen -R &quot;</span> <span class="o">+</span> <span class="n">ip</span> <span class="k">if</span> <span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;22&#39;</span> <span class="k">else</span> \
                      <span class="s2">&quot;ssh-keygen -R &quot;</span> <span class="o">+</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="n">ip</span> <span class="o">+</span> <span class="s2">&quot;]:&quot;</span> <span class="o">+</span> <span class="n">port</span>
                <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;SSH Host Key is changed - Remove it from &quot;</span>
                            <span class="s2">&quot;known_hosts file : cmd = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cmd</span><span class="p">)</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">timeout</span><span class="p">))</span>
                <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;ReconnectSSH: cmd = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">print_exception</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sshobj</span><span class="p">,</span> <span class="n">conn_string</span></div>

<div class="viewcode-block" id="connect_telnet"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.connect_telnet">[docs]</a><span class="k">def</span> <span class="nf">connect_telnet</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;23&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                   <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;.*(%|#|\$)&quot;</span><span class="p">,</span>
                   <span class="n">conn_options</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">custom_keystroke</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initiates Telnet connection via a specific port. Creates log file.</span>

<span class="sd">    :Arguments:</span>
<span class="sd">        1. ip = destination ip</span>
<span class="sd">        2. port(string) = telnet port</span>
<span class="sd">        3. username(string) = username</span>
<span class="sd">        4. password(string) = password</span>
<span class="sd">        5. logfile(string) = logfile name</span>
<span class="sd">        6. timeout(int) = timeout duration</span>
<span class="sd">        7. prompt(string) = destination prompt</span>

<span class="sd">    :Returns:</span>
<span class="sd">        1.telnet session as object</span>
<span class="sd">        2.conn_string(pre and post login message)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">conn_options</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">conn_options</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">conn_options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">conn_options</span>
    <span class="n">custom_keystroke</span> <span class="o">=</span> <span class="s2">&quot;wctrl:M&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">custom_keystroke</span> <span class="k">else</span> <span class="n">custom_keystroke</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;timeout is: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">timeout</span><span class="p">)</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;port num is: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">port</span><span class="p">)</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;telnet &#39;</span><span class="o">+</span> <span class="n">ip</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">port</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">conn_options</span> <span class="ow">or</span> <span class="n">conn_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">conn_options</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">conn_options</span><span class="p">)</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;connectTelnet cmd = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">timeout</span><span class="p">))</span>
    <span class="n">conn_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">telnetobj</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">child</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">child</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">flag</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">child</span><span class="o">.</span><span class="n">setecho</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">delaybeforesend</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="n">prompt</span><span class="p">,</span> <span class="s1">&#39;.*(?i)password:.*&#39;</span><span class="p">,</span>
                                   <span class="s2">&quot;.*(?i)(user(name)?:|login:) *$&quot;</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">telnetobj</span> <span class="o">=</span> <span class="n">child</span>
                <span class="n">conn_string</span> <span class="o">=</span> <span class="n">conn_string</span> <span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span> <span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">after</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
                <span class="n">conn_string</span> <span class="o">=</span> <span class="n">conn_string</span> <span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span> <span class="o">+</span> <span class="n">child</span><span class="o">.</span><span class="n">after</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Connection failed: </span><span class="si">{0}</span><span class="s2">, with the system response: </span><span class="si">{1}</span><span class="s2">&quot;</span>\
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="c1"># timed out tryonce with Enter has some terminal expects it</span>
                <span class="k">if</span> <span class="n">flag</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Initial timeout occur, sending custom_keystroke&quot;</span><span class="p">)</span>
                    <span class="n">_send_cmd_by_type</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">custom_keystroke</span><span class="p">)</span>
                    <span class="n">flag</span><span class="o">=</span><span class="kc">False</span>
                    <span class="k">continue</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Connection timed out: </span><span class="si">{0}</span><span class="s2">, expected prompt: </span><span class="si">{1}</span><span class="s2"> &quot;</span>\
                      <span class="s2">&quot;is not found in the system response: </span><span class="si">{2}</span><span class="s2">&quot;</span>\
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">before</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">print_error</span><span class="p">(</span><span class="s2">&quot; ! could not connect to </span><span class="si">%s</span><span class="s2">...check logs&quot;</span> <span class="o">%</span> <span class="n">ip</span><span class="p">)</span>
        <span class="n">print_exception</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">telnetobj</span><span class="p">,</span> <span class="n">conn_string</span></div>


<div class="viewcode-block" id="disconnect_telnet"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.disconnect_telnet">[docs]</a><span class="k">def</span> <span class="nf">disconnect_telnet</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Disconnects a telnet session &quot;&quot;&quot;</span>
    <span class="n">child</span><span class="o">.</span><span class="n">sendcontrol</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
    <span class="n">child</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;telnet&gt; &#39;</span><span class="p">)</span>
    <span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">child</span></div>


<div class="viewcode-block" id="disconnect"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.disconnect">[docs]</a><span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Disconnects a pexpect session</span>
<span class="sd">    - Returns session object(same child)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">isalive</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">ignore_sighup</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">ignore_sighup</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">child</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">child</span></div>

<span class="nd">@cmdprinter</span>
<div class="viewcode-block" id="send_command_and_get_response"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.send_command_and_get_response">[docs]</a><span class="k">def</span> <span class="nf">send_command_and_get_response</span><span class="p">(</span><span class="n">sessionobj</span><span class="p">,</span> <span class="n">prompt1</span><span class="p">,</span> <span class="n">prompt2</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;Sends a command to a terminal expects a completion prompt</span>
<span class="sd">    If completion prompt was found, returns the response of the command &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">boolprompt</span> <span class="o">=</span> <span class="n">sessionobj</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">prompt1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">print_info</span><span class="p">(</span><span class="s2">&quot;Could not find the prompt &quot;</span><span class="o">+</span><span class="n">prompt1</span><span class="p">)</span>
        <span class="n">print_exception</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">boolprompt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sessionobj</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sessionobj</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">prompt2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="n">print_info</span><span class="p">(</span><span class="s2">&quot;Could not find the prompt &quot;</span><span class="o">+</span><span class="n">prompt2</span><span class="p">)</span>
            <span class="n">print_exception</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">sessionobj</span><span class="o">.</span><span class="n">before</span>
    <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="smart_analyze"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.smart_analyze">[docs]</a><span class="k">def</span> <span class="nf">smart_analyze</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">testdatafile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        retrieve the correspond smart testdata file for smart cmd</span>
<span class="sd">        from either Tools/connection or testcase testdata file</span>
<span class="sd">        :param prompt:</span>
<span class="sd">            The string that will be analyzed in order to find the device system</span>
<span class="sd">        :param testdatafile:</span>
<span class="sd">            optional arg to provide a pre-defined device system in the test datafile</span>
<span class="sd">        :return:</span>
<span class="sd">            the smart datafile that contains the smart cmd to be sent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">system_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">testdatafile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># when the testdatafile is a dictionary - this happens only when</span>
        <span class="c1"># the testdatafile is taken from database server</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">testdatafile</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">db_td_obj</span> <span class="o">=</span> <span class="n">database_utils_class</span><span class="o">.</span>\
             <span class="n">create_database_connection</span><span class="p">(</span><span class="s1">&#39;dataservers&#39;</span><span class="p">,</span> <span class="n">testdatafile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;td_system&#39;</span><span class="p">))</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">db_td_obj</span><span class="o">.</span><span class="n">get_tdblock_as_xmlobj</span><span class="p">(</span><span class="n">testdatafile</span><span class="p">)</span>
            <span class="n">db_td_obj</span><span class="o">.</span><span class="n">close_connection</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">xml_Utils</span><span class="o">.</span><span class="n">getRoot</span><span class="p">(</span><span class="n">testdatafile</span><span class="p">)</span>
        <span class="n">system_name</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">_get_global_var</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;system_name&quot;</span><span class="p">)</span>

    <span class="n">con_settings_dir</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;connection&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
    <span class="n">con_settings</span> <span class="o">=</span> <span class="n">con_settings_dir</span> <span class="o">+</span> <span class="s2">&quot;connect_settings.xml&quot;</span>

    <span class="k">if</span> <span class="n">system_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sys_elem</span> <span class="o">=</span> <span class="n">xml_Utils</span><span class="o">.</span><span class="n">getElementWithTagAttribValueMatch</span><span class="p">(</span><span class="n">con_settings</span><span class="p">,</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">system_name</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sys_elem</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">sys_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;testdata&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">system_list</span> <span class="o">=</span> <span class="n">xml_Utils</span><span class="o">.</span><span class="n">getElementListWithSpecificXpath</span><span class="p">(</span><span class="n">con_settings</span><span class="p">,</span> <span class="s2">&quot;system[search_string]&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sys_elem</span> <span class="ow">in</span> <span class="n">system_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;search_string&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="n">prompt</span> <span class="ow">and</span> <span class="n">sys_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;testdata&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">con_settings_dir</span> <span class="o">+</span> <span class="n">sys_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;testdata&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">con_settings_dir</span> <span class="o">+</span> <span class="n">sys_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;testdata&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span></div>

<div class="viewcode-block" id="send_smart_cmd"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.send_smart_cmd">[docs]</a><span class="k">def</span> <span class="nf">send_smart_cmd</span><span class="p">(</span><span class="n">connect_testdata</span><span class="p">,</span> <span class="n">session_object</span><span class="p">,</span> <span class="n">tag_value</span><span class="p">,</span> <span class="n">call_system_name</span><span class="p">,</span> <span class="n">pre_tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The beacons of Gondor are lit</span>
<span class="sd">        send out the smart command</span>
<span class="sd">        :param connect_testdata:</span>
<span class="sd">            the smart testdata file that contains the smart cmd</span>
<span class="sd">        :param session_object:</span>
<span class="sd">            use this pexpect object to send out command</span>
<span class="sd">        :param tag_value:</span>
<span class="sd">            specify the testdata block of commands that get sent out</span>
<span class="sd">        :param call_system_name:</span>
<span class="sd">            in order to get passed the substitutions, a system name must be provided</span>
<span class="sd">        :param pre_tag:</span>
<span class="sd">            Distinguish if it is a connect smart action or disconnect smart action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">xml_Utils</span><span class="o">.</span><span class="n">getElementWithTagAttribValueMatch</span><span class="p">(</span><span class="n">connect_testdata</span><span class="p">,</span> <span class="s2">&quot;testdata&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="n">tag_value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**********The following command are sent as part of the smart analysis**********&quot;</span><span class="p">)</span>
        <span class="n">main_log</span> <span class="o">=</span> <span class="n">session_object</span><span class="o">.</span><span class="n">logfile</span>
        <span class="k">if</span> <span class="n">pre_tag</span><span class="p">:</span>
            <span class="n">smart_log</span> <span class="o">=</span> <span class="n">main_log</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.log&quot;</span><span class="p">,</span> <span class="s2">&quot;pre_.log&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">smart_log</span> <span class="o">=</span> <span class="n">main_log</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.log&quot;</span><span class="p">,</span> <span class="s2">&quot;post_.log&quot;</span><span class="p">)</span>
        <span class="n">session_object</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">smart_log</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
        <span class="n">send_commands_from_testdata</span><span class="p">(</span><span class="n">connect_testdata</span><span class="p">,</span> <span class="n">session_object</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">tag_value</span><span class="p">,</span> <span class="n">system_name</span><span class="o">=</span><span class="n">call_system_name</span><span class="p">)</span>
        <span class="n">session_object</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">main_log</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**********smart analysis finished**********&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">print_error</span><span class="p">()</span></div>

<div class="viewcode-block" id="smart_action"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.smart_action">[docs]</a><span class="k">def</span> <span class="nf">smart_action</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">call_system_name</span><span class="p">,</span> <span class="n">raw_prompt</span><span class="p">,</span> <span class="n">session_object</span><span class="p">,</span> <span class="n">tag_value</span><span class="p">,</span> <span class="n">connect_testdata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        entry function for sending smart command</span>
<span class="sd">        :param datafile:</span>
<span class="sd">            the testcase datafile</span>
<span class="sd">        :param call_system_name:</span>
<span class="sd">            in order to get passed the substitutions, a system name must be provided</span>
<span class="sd">        :param raw_prompt:</span>
<span class="sd">            The string that will be analyzed in order to find the device system</span>
<span class="sd">        :param session_object:</span>
<span class="sd">            use this pexpect object to send out command</span>
<span class="sd">        :param tag_value:</span>
<span class="sd">            specify the testdata block of commands that get sent out</span>
<span class="sd">        :param connect_testdata:</span>
<span class="sd">            the smart testdata file that contains the smart cmd, optional in here</span>
<span class="sd">        :return:</span>
<span class="sd">            the smart testdata file that contains the smart cmd</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">testdata</span><span class="p">,</span> <span class="n">varconfigfile</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">get_td_vc</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">call_system_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">pre_tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">connect_testdata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">connect_testdata</span> <span class="o">=</span> <span class="n">smart_analyze</span><span class="p">(</span><span class="n">raw_prompt</span><span class="p">,</span> <span class="n">testdata</span><span class="p">)</span>
        <span class="n">pre_tag</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">connect_testdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">send_smart_cmd</span><span class="p">(</span><span class="n">connect_testdata</span><span class="p">,</span> <span class="n">session_object</span><span class="p">,</span> <span class="n">tag_value</span><span class="p">,</span> <span class="n">call_system_name</span><span class="p">,</span> <span class="n">pre_tag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">connect_testdata</span>
    <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="get_connection_port"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.get_connection_port">[docs]</a><span class="k">def</span> <span class="nf">get_connection_port</span><span class="p">(</span><span class="n">conn_type</span><span class="p">,</span> <span class="n">inpdict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the port for ssh or telnet connections</span>
<span class="sd">    1. ssh :</span>
<span class="sd">        - looks if ssh_port is present in  inpdict.</span>
<span class="sd">        - if not checks for conn_port</span>
<span class="sd">        - if both not present returns None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">inpdict</span><span class="p">:</span>
        <span class="n">conn_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_port&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conn_type</span><span class="p">)</span>
        <span class="k">if</span>  <span class="n">conn_string</span> <span class="ow">in</span> <span class="n">inpdict</span> <span class="ow">and</span> <span class="n">inpdict</span><span class="p">[</span><span class="n">conn_string</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span>\
        <span class="ow">and</span> <span class="n">inpdict</span><span class="p">[</span><span class="n">conn_string</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inpdict</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpdict</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_port&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conn_type</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="s2">&quot;conn_port&quot;</span> <span class="ow">in</span> <span class="n">inpdict</span> <span class="ow">and</span> <span class="n">inpdict</span><span class="p">[</span><span class="s2">&quot;conn_port&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span>\
        <span class="ow">and</span> <span class="n">inpdict</span><span class="p">[</span><span class="s2">&quot;conn_port&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inpdict</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpdict</span><span class="p">[</span><span class="s2">&quot;conn_port&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">inpdict</span></div>

<span class="nd">@cmdprinter</span>
<div class="viewcode-block" id="send_command"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.send_command">[docs]</a><span class="k">def</span> <span class="nf">send_command</span><span class="p">(</span><span class="n">session_object</span><span class="p">,</span> <span class="n">start_prompt</span><span class="p">,</span> <span class="n">end_prompt</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span>
                 <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send an command to pexpect session object and resturns the status of the command sent</span>
<span class="sd">    - Checks for the availability of the start_prompt.</span>
<span class="sd">    - if start prompt was available sends the command</span>
<span class="sd">    - if failure response is not None and failure response fond in</span>
<span class="sd">    response then returns False.</span>
<span class="sd">    - else if failure repsonse was not found</span>
<span class="sd">    and end prompt also not found returns False.</span>
<span class="sd">    - else if failure response was not found and end prompt found,</span>
<span class="sd">    then returns true.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmout</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span><span class="mi">60</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">session_object</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmout</span><span class="p">)</span>
    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Command timeout: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">session_object</span><span class="o">.</span><span class="n">timeout</span><span class="p">))</span>
    <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">cmd_timedout</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1">#time_format = &quot;%Y-%b-%d %H:%M:%S&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">boolprompt</span> <span class="o">=</span> <span class="n">session_object</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">start_prompt</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Could not find the start_prompt &#39;</span><span class="si">{0}</span><span class="s2">&#39;!! exiting!!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">start_prompt</span><span class="p">)),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
        <span class="n">boolprompt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">boolprompt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime_utils</span><span class="o">.</span><span class="n">get_current_timestamp</span><span class="p">()</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] Sending Command: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">command</span><span class="p">))</span>
        <span class="n">_send_cmd_by_type</span><span class="p">(</span><span class="n">session_object</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">session_object</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="n">end_prompt</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">])</span> <span class="k">if</span> <span class="n">end_prompt</span>\
                <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime_utils</span><span class="o">.</span><span class="n">get_current_timestamp</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">curr_time</span> <span class="o">=</span> <span class="n">datetime_utils</span><span class="o">.</span><span class="n">get_current_timestamp</span><span class="p">()</span>
                    <span class="n">msg1</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] Command completed successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
                    <span class="n">msg2</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] Found end prompt &#39;</span><span class="si">{1}</span><span class="s2">&#39; after command had timed out&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">curr_time</span><span class="p">,</span> <span class="n">end_prompt</span><span class="p">)</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmd_timedout</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span><span class="n">msg2</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span><span class="n">msg1</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmd_timedout</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] end prompt not provided&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end_time</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] EOF encountered&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">tmsg1</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] Command timed out, command will be marked as error&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
                    <span class="n">tmsg2</span> <span class="o">=</span> <span class="s2">&quot;Will wait 60 more seconds to get end prompt &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end_prompt</span><span class="p">)</span>
                    <span class="n">tmsg3</span> <span class="o">=</span> <span class="s2">&quot;Irrespective of whether end prompt is received or not command will &quot;</span>\
                           <span class="s2">&quot;be marked as error because command had timed out once.&quot;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_timedout</span><span class="p">:</span>
                        <span class="n">session_object</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">pNote</span><span class="p">(</span><span class="n">tmsg1</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
                        <span class="n">pNote</span><span class="p">(</span><span class="n">tmsg2</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
                        <span class="n">pNote</span><span class="p">(</span><span class="n">tmsg3</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
                        <span class="n">tstamp</span> <span class="o">=</span> <span class="n">datetime_utils</span><span class="o">.</span><span class="n">get_current_timestamp</span><span class="p">()</span>
                    <span class="n">cmd_timedout</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
                    <span class="n">tdelta</span> <span class="o">=</span> <span class="n">datetime_utils</span><span class="o">.</span><span class="n">get_time_delta</span><span class="p">(</span><span class="n">tstamp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">tdelta</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] Did not find end prompt &#39;</span><span class="si">{1}</span><span class="s2">&#39; even after 60 seconds post&quot;</span>\
                              <span class="s2">&quot;command time out&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime_utils</span><span class="o">.</span><span class="n">get_current_timestamp</span><span class="p">(),</span>
                                                        <span class="n">end_prompt</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="n">print_exception</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">session_object</span><span class="o">.</span><span class="n">before</span>
            <span class="n">response</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">session_object</span><span class="o">.</span><span class="n">after</span><span class="p">)</span>
            <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Response:</span><span class="se">\n</span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
            <span class="n">pNote</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">datetime_utils</span><span class="o">.</span><span class="n">get_time_delta</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Command Duration: </span><span class="si">{0}</span><span class="s2"> sec&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">response</span></div>


<div class="viewcode-block" id="sendPing"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.sendPing">[docs]</a><span class="k">def</span> <span class="nf">sendPing</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sends a ping command</span>
<span class="sd">    :Arguments:</span>
<span class="sd">        1. count(string) = no of pings to be sent</span>
<span class="sd">        2. src_iface(string) = source interface from whihc ping messages</span>
<span class="sd">                                are to be sent.</span>
<span class="sd">        3. destip(string) = the destination ip address to ping.</span>
<span class="sd">        4. fname = logfile to log ping response.</span>
<span class="sd">    :Returns:</span>
<span class="sd">        status = boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;ping -c &quot;</span> <span class="o">+</span> <span class="n">count</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">hostname</span> <span class="o">+</span> <span class="s2">&quot; &gt;&gt;&quot;</span> <span class="o">+</span> <span class="n">fname</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;sendPing, cmd = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;hostname : &#39;</span><span class="si">%s</span><span class="s2">&#39; is up &quot;</span> <span class="o">%</span> <span class="n">hostname</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;hostname : &#39;</span><span class="si">%s</span><span class="s2">&#39; is down &quot;</span> <span class="o">%</span> <span class="n">hostname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">status</span></div>


<div class="viewcode-block" id="sendSourcePing"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.sendSourcePing">[docs]</a><span class="k">def</span> <span class="nf">sendSourcePing</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">src_iface</span><span class="p">,</span> <span class="n">destip</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sends a source based ping command</span>
<span class="sd">    i.e. if multiple interfaces are configured and available,</span>
<span class="sd">    sends pings from the src_iface provided</span>
<span class="sd">    :Arguments:</span>
<span class="sd">        1. count(string) = no of pings to be sent</span>
<span class="sd">        2. src_iface(string) = source interface from whihc ping messages</span>
<span class="sd">                                are to be sent.</span>
<span class="sd">        3. destip(string) = the destination ip address to ping.</span>
<span class="sd">        4. fname = logfile to log ping response.</span>
<span class="sd">    :Returns:</span>
<span class="sd">        status = boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;ping -c &quot;</span> <span class="o">+</span> <span class="n">count</span> <span class="o">+</span> <span class="s2">&quot; -I &quot;</span> <span class="o">+</span> <span class="n">src_iface</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">destip</span> <span class="o">+</span> <span class="s2">&quot; &gt;&gt;&quot;</span> <span class="o">+</span> <span class="n">fname</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;command, cmd = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;hostname : &#39;</span><span class="si">%s</span><span class="s2">&#39; is up &quot;</span> <span class="o">%</span> <span class="n">destip</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;hostname : &#39;</span><span class="si">%s</span><span class="s2">&#39; is down &quot;</span> <span class="o">%</span> <span class="n">destip</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">status</span></div>


<div class="viewcode-block" id="send_commands_from_testdata"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.send_commands_from_testdata">[docs]</a><span class="k">def</span> <span class="nf">send_commands_from_testdata</span><span class="p">(</span><span class="n">testdatafile</span><span class="p">,</span> <span class="n">obj_session</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Parses the testdata file and gets the command details</span>
<span class="sd">    for rows marked execute=yes and row=str_rownum.</span>
<span class="sd">    - Sends the obtained commands to the pexpect session (obj_Session).</span>
<span class="sd">    - If the commands have verification attribute set,</span>
<span class="sd">    then verifies the verification text for presence/absence as defined</span>
<span class="sd">    in the respective found attribute in the testdatfile.</span>

<span class="sd">    :Arguments:</span>
<span class="sd">        1. testdatafile = the xml file where command details are available</span>
<span class="sd">        2. obj_session = pexpect session object</span>
<span class="sd">        3. logfile = logfile of the pexpect session object.</span>
<span class="sd">        4. varconfigfile=  xml file from which the values will be taken for subtitution</span>
<span class="sd">        5. var_sub(string) = the pattern [var_sub] in the testdata commands,</span>
<span class="sd">                                 start_prompt, end_prompt, verification search</span>
<span class="sd">                                 will substituted with this value.</span>
<span class="sd">        6. args = Optional filter to specify title/rownum</span>
<span class="sd">    :Returns:</span>
<span class="sd">        1. finalresult = boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">responses_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">varconfigfile</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;varconfigfile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">datafile</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;datafile&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">var_sub</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;var_sub&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">WarriorCliClass</span><span class="o">.</span><span class="n">cmdprint</span><span class="p">:</span>
        <span class="n">pNote</span><span class="p">(</span> <span class="s2">&quot;**************</span><span class="si">{}</span><span class="s2">**************&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Title: &#39;</span> <span class="o">+</span> <span class="n">title</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;**************</span><span class="si">{}</span><span class="s2">**************&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Row: &#39;</span> <span class="o">+</span> <span class="n">row</span><span class="p">))</span>
    <span class="n">system_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system_name&quot;</span><span class="p">)</span>
    <span class="n">testdata_dict</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">get_command_details_from_testdata</span><span class="p">(</span><span class="n">testdatafile</span><span class="p">,</span> <span class="n">varconfigfile</span><span class="p">,</span>
                                                                 <span class="n">var_sub</span><span class="o">=</span><span class="n">var_sub</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                                                                 <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">system_name</span><span class="o">=</span><span class="n">system_name</span><span class="p">,</span> <span class="n">datafile</span><span class="o">=</span><span class="n">datafile</span><span class="p">)</span>
    <span class="n">finalresult</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">testdata_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">details_dict</span> <span class="ow">in</span> <span class="n">testdata_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">response_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">responses_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">command_list</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;command_list&quot;</span><span class="p">]</span>
        <span class="n">stepdesc</span> <span class="o">=</span> <span class="s2">&quot;Send the following commands: &quot;</span>
        <span class="n">pNote</span><span class="p">(</span><span class="n">stepdesc</span><span class="p">)</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">commands</span> <span class="ow">in</span> <span class="n">command_list</span><span class="p">:</span>
            <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Command #</span><span class="si">{0}</span><span class="se">\t</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">commands</span><span class="p">))</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">intsize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">command_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intsize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">finalresult</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Send Commands</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">intsize</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&gt;&quot;</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;command_list&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Command #</span><span class="si">{0}</span><span class="se">\t</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">command</span><span class="p">))</span>
            <span class="n">new_obj_session</span><span class="p">,</span> <span class="n">details_dict</span> <span class="o">=</span> <span class="n">_get_obj_session</span><span class="p">(</span><span class="n">details_dict</span><span class="p">,</span> <span class="n">obj_session</span><span class="p">,</span> <span class="n">system_name</span><span class="p">,</span>
                                                         <span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_obj_session</span><span class="p">:</span>
                <span class="n">result</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">_send_cmd_get_status</span><span class="p">(</span><span class="n">new_obj_session</span><span class="p">,</span> <span class="n">details_dict</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">system_name</span><span class="o">=</span><span class="n">system_name</span><span class="p">)</span>
                <span class="n">result</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">_send_command_retrials</span><span class="p">(</span><span class="n">new_obj_session</span><span class="p">,</span> <span class="n">details_dict</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                                                          <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">system_name</span><span class="o">=</span><span class="n">system_name</span><span class="p">)</span>
                <span class="n">response_dict</span> <span class="o">=</span> <span class="n">_get_response_dict</span><span class="p">(</span><span class="n">details_dict</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span>
                                                   <span class="n">response_dict</span><span class="p">)</span>
                <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;&lt;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">finalresult</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
                <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;COMMAND STATUS:</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">finalresult</span><span class="p">))</span>
                <span class="n">print_debug</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;&lt;&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span> <span class="ow">or</span> <span class="n">finalresult</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
                <span class="n">finalresult</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
            <span class="n">finalresult</span> <span class="o">=</span> <span class="n">finalresult</span> <span class="ow">and</span> <span class="n">result</span>
        <span class="n">responses_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">response_dict</span>
    <span class="k">return</span> <span class="n">finalresult</span><span class="p">,</span> <span class="n">responses_dict</span></div>

<span class="nd">@cmdprinter</span>
<span class="k">def</span> <span class="nf">_send_cmd</span><span class="p">(</span><span class="n">obj_session</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;method to send command based on the type of object &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_session</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">):</span>
        <span class="n">startprompt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;startprompt&#39;</span><span class="p">,</span> <span class="s2">&quot;.*&quot;</span><span class="p">)</span>
        <span class="n">endprompt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;endprompt&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cmd_timeout</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmd_timeout&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="n">obj_session</span><span class="p">,</span> <span class="n">startprompt</span><span class="p">,</span> <span class="n">endprompt</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">cmd_timeout</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_session</span><span class="p">,</span> <span class="n">Framework</span><span class="o">.</span><span class="n">ClassUtils</span><span class="o">.</span><span class="n">ssh_utils_class</span><span class="o">.</span><span class="n">SSHComm</span><span class="p">):</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">obj_session</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">print_info</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">response</span>


<span class="k">def</span> <span class="nf">_get_response_dict</span><span class="p">(</span><span class="n">details_dict</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">response_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the response dict for a command. &quot;&quot;&quot;</span>
    <span class="n">resp_ref</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;resp_ref_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">resp_req</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;resp_req_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">resp_pat_req</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;resp_pat_req_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

    <span class="n">resp_req</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">:</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
                <span class="s1">&#39;no&#39;</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resp_req</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">resp_ref</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span> <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resp_ref</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">resp_ref</span><span class="p">))</span>
    <span class="c1">#response_key=resp_ref_list[i] if resp_ref_list[i] else i+1</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">resp_req</span><span class="o">==</span><span class="s2">&quot;n&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">resp_pat_req</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if the requested pattern not found return empty string</span>
            <span class="n">reobj</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">resp_pat_req</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
            <span class="n">response</span><span class="o">=</span><span class="n">reobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">reobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;User has requested saving response. Response pattern required by user is : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp_pat_req</span><span class="p">))</span>
            <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Portion of response saved to the data repository with key: </span><span class="si">{0}</span><span class="s2">, value: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp_ref</span><span class="p">,</span> <span class="n">response</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">response</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="n">response_dict</span><span class="p">[</span><span class="n">resp_ref</span><span class="p">]</span><span class="o">=</span><span class="n">response</span>
    <span class="k">return</span> <span class="n">response_dict</span>


<div class="viewcode-block" id="start_threads"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.start_threads">[docs]</a><span class="k">def</span> <span class="nf">start_threads</span><span class="p">(</span><span class="n">started_thread_for_system</span><span class="p">,</span> <span class="n">thread_instance_list</span><span class="p">,</span> <span class="n">same_system</span><span class="p">,</span> <span class="n">unique_log_verify_list</span><span class="p">,</span> <span class="n">system_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function iterates over unique_log_verify_list which consists of unique values</span>
<span class="sd">    gotten from monitor attributes and verify_on attributes</span>

<span class="sd">    If a system_name has a * against it, it indicates that the system is the</span>
<span class="sd">    same as the one on which the testcase is running. Thread would not be</span>
<span class="sd">    started for that system.</span>

<span class="sd">    :Returns:</span>

<span class="sd">    started_thread_for_system (list[str]) = Stores the system names for which</span>
<span class="sd">    threads were succesfully created</span>

<span class="sd">    thread_instance_list (list[str]) = stores the instances of thread created</span>
<span class="sd">    for corresponding system in the started_thread_for_system list,</span>

<span class="sd">    same_system (list[str]) = stores the system name which was the same as the</span>
<span class="sd">    system on which the TC is running without the trailing *,</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">started_thread_for_system</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">thread_instance_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">same_system</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_log_verify_list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">system_name</span><span class="p">:</span>
            <span class="n">temp_list</span> <span class="o">=</span> <span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">get_session_id</span><span class="p">(</span><span class="n">temp_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">get_session_id</span><span class="p">(</span><span class="n">temp_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">same_system</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">temp_list</span> <span class="o">=</span> <span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">get_session_id</span><span class="p">(</span><span class="n">temp_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">get_session_id</span><span class="p">(</span><span class="n">temp_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">datarep_obj</span> <span class="o">=</span> <span class="n">get_object_from_datarepository</span><span class="p">(</span><span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">datarep_obj</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">print_info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> does not exist in data repository&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">new_thread</span> <span class="o">=</span> <span class="n">ThreadedLog</span><span class="p">()</span>
                        <span class="n">new_thread</span><span class="o">.</span><span class="n">start_thread</span><span class="p">(</span><span class="n">datarep_obj</span><span class="p">)</span>
                        <span class="n">print_info</span><span class="p">(</span><span class="s2">&quot;Collecting response from: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                        <span class="n">started_thread_for_system</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">thread_instance_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_thread</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">print_info</span><span class="p">(</span><span class="s2">&quot;Unable to collect response from: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unique_log_verify_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">started_thread_for_system</span><span class="p">,</span> <span class="n">thread_instance_list</span><span class="p">,</span> <span class="n">same_system</span></div>


<div class="viewcode-block" id="get_response_dict"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.get_response_dict">[docs]</a><span class="k">def</span> <span class="nf">get_response_dict</span><span class="p">(</span><span class="n">started_thread_for_system</span><span class="p">,</span> <span class="n">thread_instance_list</span><span class="p">,</span> <span class="n">same_system</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function iterates over thread_instance_list and gets the data that</span>
<span class="sd">    the threads have stored in its data variable. Updates the remote_resp_dict</span>
<span class="sd">    with the system name and the corresponding data collected.</span>

<span class="sd">    The system names in same_system also get stored in the remote_resp_dict but</span>
<span class="sd">    their value is the same as the response that was obtained through the</span>
<span class="sd">    _send_cmd function</span>

<span class="sd">    :Returns:</span>

<span class="sd">    remote_resp_dict (dict) with collected logs as value to the system_name key</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">remote_resp_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">same_system</span><span class="p">)):</span>
        <span class="n">remote_resp_dict</span><span class="p">[</span><span class="n">same_system</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">response</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">started_thread_for_system</span><span class="p">)):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">thread_instance_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">thread_instance_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stop_thread</span><span class="p">()</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">++++++++++++++++++++++++ RESPONSE FROM SYSTEM: </span><span class="si">{0}</span><span class="s2"> ++++++++++++++++++++</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">started_thread_for_system</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">pNote</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">++++++++++++++++++++++++ END OF DATA FROM SYSTEM: </span><span class="si">{0}</span><span class="s2"> ++++++++++++++++++++</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">started_thread_for_system</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">remote_resp_dict</span><span class="p">[</span><span class="n">started_thread_for_system</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">return</span> <span class="n">remote_resp_dict</span></div>


<div class="viewcode-block" id="get_unique_log_and_verify_list"><a class="viewcode-back" href="../../../Framework.Utils.html#Framework.Utils.cli_Utils.get_unique_log_and_verify_list">[docs]</a><span class="k">def</span> <span class="nf">get_unique_log_and_verify_list</span><span class="p">(</span><span class="n">log_list</span><span class="p">,</span> <span class="n">verify_on_list</span><span class="p">,</span> <span class="n">system_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function loops through the log_list and the verify_on_list</span>
<span class="sd">    and returns a unique list containing unique sustem names fromboth the lists</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">final_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">log_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">log_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">log_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">comma_sep_log_names</span> <span class="o">=</span> <span class="n">log_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">comma_sep_log_names</span><span class="p">)):</span>
            <span class="n">comma_sep_log_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">comma_sep_log_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">comma_sep_log_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">comma_sep_verify_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">verify_on_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">verify_on_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">verify_on_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">verify_on_list</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">verify_on_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">verify_on_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">verify_on_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">temp_list</span> <span class="o">=</span> <span class="n">verify_on_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_list</span><span class="p">)):</span>
                    <span class="n">comma_sep_verify_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">comma_sep_verify_names</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">comma_sep_verify_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">comma_sep_log_names</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">comma_sep_log_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">final_list</span><span class="p">:</span>
            <span class="n">final_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comma_sep_log_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">comma_sep_verify_names</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">comma_sep_verify_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">comma_sep_verify_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_name</span>
        <span class="k">if</span> <span class="n">comma_sep_verify_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">final_list</span><span class="p">:</span>
            <span class="n">final_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comma_sep_verify_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">final_list</span></div>

<span class="nd">@cmdprinter</span>
<span class="k">def</span> <span class="nf">_send_cmd_get_status</span><span class="p">(</span><span class="n">obj_session</span><span class="p">,</span> <span class="n">details_dict</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">system_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sends a command, verifies the response and returns</span>
<span class="sd">    status of the command &quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;command_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">startprompt</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;startprompt_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">endprompt</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;endprompt_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">verify_list</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;verify_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">cmd_timeout</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;timeout_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">verify_text_list</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;verify_text_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">verify_context_list</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;verify_context_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">sleeptime</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;sleeptime_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">resp_ref</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;resp_ref_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">resp_req</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;resp_req_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">resp_pat_req</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;resp_pat_req_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">verify_on_list</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;verify_on_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">log_list</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;log_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">inorder_search</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;inorder_search_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">varconfigfile</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;vc_file_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">unique_log_verify_list</span> <span class="o">=</span> <span class="n">get_unique_log_and_verify_list</span><span class="p">(</span><span class="n">log_list</span><span class="p">,</span> <span class="n">verify_on_list</span><span class="p">,</span> <span class="n">system_name</span><span class="p">)</span>

    <span class="n">startprompt</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="s2">&quot;.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span><span class="s2">&quot;.*&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">startprompt</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">startprompt</span><span class="p">))</span>
    <span class="n">resp_req</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">:</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
                <span class="s1">&#39;no&#39;</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resp_req</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">resp_ref</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resp_ref</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">resp_ref</span><span class="p">))</span>
    <span class="n">resp_pat_req</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resp_pat_req</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">resp_pat_req</span><span class="p">))</span>
    <span class="n">sleeptime</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">))</span>
    <span class="n">sleeptime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span>
    <span class="n">inorder_search</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">inorder_search</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                     <span class="n">inorder_search</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Startprompt</span><span class="se">\t</span><span class="s2">: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">startprompt</span><span class="p">))</span>
    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Endprompt</span><span class="se">\t</span><span class="s2">: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endprompt</span><span class="p">))</span>
    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Sleeptime</span><span class="se">\t</span><span class="s2">: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">))</span>
    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Response required: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp_req</span><span class="p">))</span>
    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Response reference: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp_ref</span><span class="p">))</span>
    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Response pattern required: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp_pat_req</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="p">:</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Received a boolean False or None type instead of a string command, &quot;</span>
              <span class="s2">&quot;Command not provided or Variable substitution for the &quot;</span>
              <span class="s2">&quot;command could have gone wrong&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Skipping execution of this command, result will be marked as error&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;ERROR&#39;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">started_thread_for_system</span><span class="p">,</span> <span class="n">thread_instance_list</span><span class="p">,</span> <span class="n">same_system</span> <span class="o">=</span> \
            <span class="n">start_threads</span><span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">unique_log_verify_list</span><span class="p">,</span> <span class="n">system_name</span><span class="p">)</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">_send_cmd</span><span class="p">(</span><span class="n">obj_session</span><span class="p">,</span> <span class="n">startprompt</span><span class="o">=</span><span class="n">startprompt</span><span class="p">,</span>
                                     <span class="n">endprompt</span><span class="o">=</span><span class="n">endprompt</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">,</span>
                                     <span class="n">cmd_timeout</span><span class="o">=</span><span class="n">cmd_timeout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sleeptime</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Sleep time of &#39;</span><span class="si">{0}</span><span class="s2"> seconds&#39; requested post command execution&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">remote_resp_dict</span> <span class="o">=</span> <span class="n">get_response_dict</span><span class="p">(</span><span class="n">started_thread_for_system</span><span class="p">,</span>
                                             <span class="n">thread_instance_list</span><span class="p">,</span>
                                             <span class="n">same_system</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="n">remote_resp_dict</span> <span class="o">=</span> <span class="n">get_response_dict</span><span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">response</span><span class="p">)</span>
    <span class="n">verify_on_list_as_list</span> <span class="o">=</span> <span class="n">get_list_by_separating_strings</span><span class="p">(</span><span class="n">verify_on_list</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">system_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verify_text_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">verify_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inorder_search</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">verify_text_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">verify_resp_inorder</span><span class="p">(</span><span class="n">verify_text_list</span><span class="p">,</span>
                         <span class="n">verify_context_list</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">varconfigfile</span><span class="p">,</span>
                         <span class="n">verify_on_list_as_list</span><span class="p">,</span> <span class="n">verify_list</span><span class="p">,</span> <span class="n">remote_resp_dict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">verify_resp_across_sys</span><span class="p">(</span><span class="n">verify_text_list</span><span class="p">,</span>
                         <span class="n">verify_context_list</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">varconfigfile</span><span class="p">,</span>
                         <span class="n">verify_on_list_as_list</span><span class="p">,</span> <span class="n">verify_list</span><span class="p">,</span> <span class="n">remote_resp_dict</span><span class="p">,</span> <span class="n">endprompt</span><span class="p">)</span>
    <span class="n">command_status</span> <span class="o">=</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;PASS&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span><span class="s2">&quot;FAIL&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span><span class="s2">&quot;ERROR&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;COMMAND STATUS:</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command_status</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">response</span>


<span class="k">def</span> <span class="nf">_get_obj_session</span><span class="p">(</span><span class="n">details_dict</span><span class="p">,</span> <span class="n">obj_session</span><span class="p">,</span> <span class="n">kw_system_name</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If system name is provided in testdata file</span>
<span class="sd">    get the session of that system name and use it or</span>
<span class="sd">    use the current obj_session&quot;&quot;&quot;</span>

    <span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">kw_system_nameonly</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">split_system_subsystem</span><span class="p">(</span><span class="n">kw_system_name</span><span class="p">)</span>
    <span class="n">td_sys</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;sys_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="c1"># To get the session name if it is provided as part of sys tag in td</span>
    <span class="n">td_sys_split</span> <span class="o">=</span> <span class="n">td_sys</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">td_sys</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">td_sys_split</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">td_sys</span> <span class="o">=</span> <span class="n">td_sys_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">td_sys_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;session_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

    <span class="n">td_sys</span> <span class="o">=</span> <span class="n">td_sys</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">td_sys</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">td_sys</span>
    <span class="n">td_sys</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">td_sys</span><span class="p">,</span> <span class="n">td_sys</span><span class="p">)</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">session</span>
    <span class="n">session</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">td_sys</span><span class="p">:</span>
        <span class="n">system_name</span> <span class="o">=</span> <span class="n">kw_system_nameonly</span> <span class="o">+</span> <span class="n">td_sys</span> <span class="k">if</span> <span class="n">td_sys</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span> \
        <span class="ow">and</span> <span class="n">td_sys</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">td_sys</span>
        <span class="n">session_id</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">get_session_id</span><span class="p">(</span><span class="n">system_name</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
        <span class="n">obj_session</span> <span class="o">=</span> <span class="n">data_Utils</span><span class="o">.</span><span class="n">get_object_from_datarepository</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj_session</span><span class="p">:</span>
            <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Could not find a valid connection for &quot;</span>\
                  <span class="s2">&quot;system_name=</span><span class="si">{}</span><span class="s2">, session_name=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">system_name</span><span class="p">,</span> <span class="n">session</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">obj_session</span>
            <span class="c1"># details_dict =</span>
            <span class="c1"># _update_details_dict(system_name, datafile, details_dict, var_sub)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># print obj_session</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">obj_session</span>
        <span class="n">system_name</span> <span class="o">=</span> <span class="n">kw_system_name</span>

    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;System name</span><span class="se">\t</span><span class="s2">: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">system_name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">value</span><span class="p">,</span> <span class="n">details_dict</span>

<span class="nd">@cmdprinter</span>
<span class="k">def</span> <span class="nf">_send_command_retrials</span><span class="p">(</span><span class="n">obj_session</span><span class="p">,</span> <span class="n">details_dict</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Sends a command to a session, if a user provided pattern</span>
<span class="sd">    is found in the command response then tries to resend the command multiple</span>
<span class="sd">    times.</span>
<span class="sd">    retry_timer = time interval between subsequent retries</span>
<span class="sd">    retry_onmatch = the pattern to be matched in the response</span>
<span class="sd">                    in order to retry the command.</span>
<span class="sd">    retry_count = no of times to retry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">retry</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;retry_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">retry</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">retry</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">retry</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retry</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">result</span> <span class="o">==</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">):</span>
        <span class="n">retry_timer</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;retry_timer_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
        <span class="n">retry_onmatch</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;retry_onmatch_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
        <span class="n">retry_count</span> <span class="o">=</span> <span class="n">details_dict</span><span class="p">[</span><span class="s2">&quot;retry_count_list&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
        <span class="n">retry_timer</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span><span class="mi">60</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">retry_timer</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">retry_timer</span><span class="p">)</span>
        <span class="n">retry_count</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">retry_count</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">retry_count</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Retry was requested for the command&quot;</span><span class="p">)</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Command re-trials will begin since the most recent &quot;</span>\
              <span class="s2">&quot;command status was FAIL or ERROR&quot;</span><span class="p">)</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Retry count</span><span class="se">\t</span><span class="s2">: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retry_count</span><span class="p">))</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Retry timer</span><span class="se">\t</span><span class="s2">: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retry_timer</span><span class="p">))</span>
        <span class="n">retry_onmatch</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">retry_onmatch</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">retry_onmatch</span><span class="p">))</span>
        <span class="n">print_onmatch</span> <span class="o">=</span> <span class="p">{</span><span class="kc">False</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">retry_onmatch</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">retry_onmatch</span><span class="p">))</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Retry onmatch: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">print_onmatch</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">retry_count</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">result</span> <span class="o">==</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">:</span>
                <span class="n">match_status</span> <span class="o">=</span> <span class="n">_get_match_status</span><span class="p">(</span><span class="n">retry_onmatch</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match_status</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;RETRIAL ATTEMPT:</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
                    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Wait for </span><span class="si">{0}</span><span class="s2">sec (retry_timer) before sending&quot;</span>\
                               <span class="s2">&quot; the command again&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retry_timer</span><span class="p">))</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">retry_timer</span><span class="p">))</span>
                    <span class="n">result</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">_send_cmd_get_status</span><span class="p">(</span><span class="n">obj_session</span><span class="p">,</span> <span class="n">details_dict</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">system_name</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system_name&quot;</span><span class="p">))</span>
                    <span class="n">command_status</span> <span class="o">=</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;PASS&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span><span class="s2">&quot;FAIL&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span><span class="s2">&quot;ERROR&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                    <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;RETRIAL ATTEMPT:</span><span class="si">{0}</span><span class="s2"> STATUS:</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">command_status</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">response</span>


<span class="k">def</span> <span class="nf">_get_match_status</span><span class="p">(</span><span class="n">retry_onmatch</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">retry_onmatch</span><span class="p">:</span>
        <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Command will be executed again if &quot;</span>\
              <span class="s2">&quot;the pattern </span><span class="si">{0}</span><span class="s2"> is present in the &quot;</span>
              <span class="s2">&quot;response of the previous execution of the command&quot;</span>\
              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retry_onmatch</span><span class="p">))</span>
        <span class="n">match_object</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">retry_onmatch</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match_object</span><span class="p">:</span>
            <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Found the pattern &#39;</span><span class="si">{0}</span><span class="s2">&#39; &quot;</span>\
                  <span class="s2">&quot;in the response of the previous execution &quot;</span>\
                  <span class="s2">&quot;of the command&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retry_onmatch</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pNote</span><span class="p">(</span><span class="s2">&quot;Did not find the pattern &#39;</span><span class="si">{0}</span><span class="s2">&#39; &quot;</span>\
                  <span class="s2">&quot;in the response of the previous execution &quot;</span>\
                  <span class="s2">&quot;of the command&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retry_onmatch</span><span class="p">))</span>
            <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">status</span>


<span class="k">def</span> <span class="nf">_send_cmd_by_type</span><span class="p">(</span><span class="n">session_object</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine the command type and</span>
<span class="sd">    send accordingly &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;wctrl:&quot;</span><span class="p">):</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;wctrl:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">session_object</span><span class="o">.</span><span class="n">sendcontrol</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">session_object</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


<span class="c1">##################</span>
<span class="c1"># Uses telnet_Utils.Tnet_Comm object as input</span>
<span class="c1"># def send_telnet_command(telnet_session, command, start_prompt=&#39;&#39;,</span>
<span class="c1">#                         end_prompt=&#39;&#39;, failure_resp=&#39;&#39;):</span>
<span class="c1">#     &quot;&quot;&quot; Takes a telnet session object created using</span>
<span class="c1">#     telnet_Utils.Tnet_Comm object as input</span>
<span class="c1">#     Sends a tl1 command to the telnet session and verifies the end</span>
<span class="c1">#     prompt/failure response</span>
<span class="c1">#     :Returns:</span>
<span class="c1">#         1. True, response = if end prompt is encountered</span>
<span class="c1">#         2. False, response = if failure_resp is encountered</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     #print &quot;start prompt is : {0}&quot;.format(start_prompt)</span>
<span class="c1">#     msg = &#39;Send Command:{0}&#39;.format(command)</span>
<span class="c1">#     pNote(msg)</span>
<span class="c1">#     try:</span>
<span class="c1">#         response = telnet_session.get_response(command, end_prompt)</span>
<span class="c1">#         print_info(&quot;Response:{0}&quot;.format(response))</span>
<span class="c1">#     except Exception as exception:</span>
<span class="c1">#         print_debug(&quot;Could not find the end prompt %s or failure &quot;</span>
<span class="c1">#                     &quot;response %s &quot;% (end_prompt, failure_resp))</span>
<span class="c1">#         err = print_exception(exception)</span>
<span class="c1">#         return False, str(err)</span>
<span class="c1">#</span>
<span class="c1">#     e_prompt = re.compile(end_prompt, re.DOTALL)</span>
<span class="c1">#     f_resp = re.compile(failure_resp, re.DOTALL)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#     if re.search(f_resp, response):</span>
<span class="c1">#         return (False, response)</span>
<span class="c1">#     elif re.search(e_prompt, response):</span>
<span class="c1">#         return (True, response)</span>
<span class="c1">#     else:</span>
<span class="c1">#         return (False, response)</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, FNC.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'Ninja',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>